@model Tuple< IEnumerable<Pocket.ViewModels.CategoryBudgetAmount>,IEnumerable<Pocket.ViewModels.EventBudgetAmount>,bool>
@{
    ViewBag.Title = Pocket.Common.Global.ApplicationName;
}
<script src="~/Scripts/bootstrap-switch.min.js"></script>
<link href="~/Content/bootstrap-switch.min.css" rel="stylesheet" />
<style>
    /*.progress {
        position: relative;
    }

    .bar {
        z-index: 1;
        position: absolute;
    }

    .progress span {
        position: absolute;
        top: 0;
        z-index: 2;
        //text-align: center;
        width: 100%;
        color: black;
    }
    .row > li:before {
        display: none;
    }*/
</style>
<br />
<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">Monthly Budget & Expense Details <input type="checkbox" name="my-checkbox" @(Model.Item3?"checked":"") data-on-text="Budget" data-off-text="Limit" data-size="mini" data-off-color="success" /></h3>
    </div>
    <div class="panel-body center-block">



                @{
                    int ids = 1;
                    var cats = Model.Item1;
                }
                @foreach (var cat in cats)
{
    <div class="row">
        <div class="list-group">
            <div class="list-group-item-heading active">
                <a href="#" onclick="$('#li@(ids)').toggle('slow')">@cat.Name</a> (@cat.Amount / @cat.Budget)

                <div class="progress">
                    <div class="progress-bar progress-bar-@cat.BugetStatus progress-bar-striped" role="progressbar" aria-valuenow="@cat.BudgetPercentage" aria-valuemin="0" aria-valuemax="100" style="width: @cat.BudgetPercentage%">
                        <span>
                            @Math.Round(cat.Budget - cat.Amount, 2)
                        </span>
                    </div>
                </div>
            </div>
            <div class="list-group-item-text collapse" id="li@(ids++)">
                <div class="list-group col-lg-4">
                    @foreach (var scat in cat.Subcategories)
                    {
                        <div class="list-group-item-text">
                            @scat.Name (@scat.Amount / @scat.Budget)
                            <div class="progress">
                                <div class="progress-bar progress-bar-@scat.BugetStatus progress-bar-striped" role="progressbar" aria-valuenow="@scat.BudgetPercentage" aria-valuemin="0" aria-valuemax="100" style="width: @scat.BudgetPercentage%">
                                    <span>
                                        @Math.Round(scat.Budget - scat.Amount, 2)
                                    </span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>

        </div>
    </div>
}
        @{
            var evabs = Model.Item2;
            double etbudget = evabs.Select(b => b.Budget).DefaultIfEmpty(0).Sum();
            double etamount = evabs.Select(b => b.Amount).DefaultIfEmpty(0).Sum();
            double diff = etbudget - etamount;
        }
        <div class="row">
            <div class="list-group">
                <div class="list-group-item-heading active">
                    <a href="#" onclick="$('#liEvents').toggle('slow')">My Events</a>

                    <div class="progress">
                        <div class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="@((int)((diff / (etbudget == 0 ? 1 : etbudget)) * 100))" aria-valuemin="0" aria-valuemax="100" style="width: @((int)((diff / (etbudget == 0 ? 1 : etbudget)) * 100))%">
                            <span>
                                @Math.Round(etbudget - etamount, 2)
                            </span>
                        </div>
                    </div>
                </div>
                <div class="list-group-item-text collapse" id="liEvents">
                    <div class="list-group col-lg-4">
                        @foreach (var evab in evabs)
                        {
                            <div class="list-group-item-text">
                                @evab.Name (@evab.Amount / @evab.Budget)
                                <div class="progress">
                                    <div class="progress-bar progress-bar-@evab.BugetStatus progress-bar-striped" role="progressbar" aria-valuenow="@evab.BudgetPercentage" aria-valuemin="0" aria-valuemax="100" style="width: @evab.BudgetPercentage%">
                                        <span>
                                            @Math.Round(evab.Budget - evab.Amount, 2)
                                        </span>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>
<script type="text/javascript">
    $("[name='my-checkbox']").bootstrapSwitch();
    $('input[name="my-checkbox"]').on('switchChange.bootstrapSwitch', function (event, state) {
        window.location.href = "/Home/Budget/?ConstantBudget=" + state;
    });
</script>