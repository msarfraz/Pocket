@model IEnumerable<Pocket.Models.Expense>

@{
    ViewBag.Title = "List";
}

<link href="~/Content/ui.jqgrid.css" rel="stylesheet" />
<link href="~/Content/themes/redmond/jquery.ui.datepicker.css" rel="stylesheet" />

<script src="~/Scripts/grid.locale-en.js"></script>
<script src="~/Scripts/jquery.jqGrid.src.js"></script>
<script src="~/Scripts/QIE/JqGrid.js"></script>
<script src="~/Scripts/QIE/DatePickerReady.js"></script>

<br />
<p>
    
   
    <label for="ddlMonth">Report for the month:</label>
    <select name="ddlMonth" id="ddlMonth" onchange="ReloadGrid()">
        <option value="1" label="January"/>
        <option value="2" label="February" />
        <option value="3" label="March" />
        <option value="4" label="April" />
        <option value="5" label="May" />
        <option value="6" label="June" />
        <option value="7" label="July" />
        <option value="8" label="August" />
        <option value="9" label="September" />
        <option value="10" label="October" />
        <option value="11" label="November" />
        <option value="12" label="December" />
    </select>
    <select name="ddlYear" id="ddlYear" onchange="ReloadGrid()">
        @for (int i = 2001; i < 2020; i++)
        {
            <option value="@i" label="@i" />
        }
    </select>
    
</p>

<table id="rowed2"></table>
<div id="prowed2"></div>
<div>
    @Html.AntiForgeryToken()
</div>
<script type="text/javascript">
    var colNames = ['ExpenseID', 'Expense Date', 'Account', 'Amount','Budget', 'Payee', 'Vendor', 'Event'];
    var colModel = [
        { name: 'id', index: 'id', width: 55, key: true, hidden: true },
        { name: 'ExpenseDate', index: 'ExpenseDate', width: 300},
        { name: 'AccountID', index: 'AccountID', width: 100},
        { name: 'Amount', index: 'Amount', width: 100, formatter: CatFormatter },
        { name: 'Budget', index: 'Budget', width:100, hidden:true },
        { name: 'PayeeID', index: 'PayeeID', width: 100 },
        { name: 'VendorID', index: 'VendorID', width: 100 },
        { name: 'EventID', index: 'PayeeID', width: 100 }

    ];

    function ReloadGrid() {
        jQuery("#rowed2").jqGrid().trigger("reloadGrid");
    }
    function CatFormatter(cellvalue, options, rowObject) {
        // format the cellvalue to new format

        if (cellvalue && cellvalue.length > 0) {
            if (rowObject[options.pos + 1] && parseInt(cellvalue) > parseInt(rowObject[options.pos + 1])) //budget
            {
                return "<span style='color:red' title='Budget Amount:" + parseInt(rowObject[options.pos + 1]) + "'>" + cellvalue + "</span>";
            }
            
        }
            return cellvalue;

    }
    
    $("#ddlMonth").val('@DateTime.Today.Month');
    $("#ddlYear").val('@DateTime.Today.Year');
    var postData = {};
    postData["Month"] = function () { return $("#ddlMonth").val() };
    postData["Year"] = function () { return $("#ddlYear").val(); };
    /*
    $("#rowed2").jqGrid({
        url: '/report/JCategoryReport',
        datatype: 'json',
        mtype: 'GET',
        colNames: colNames,
        colModel: colModel,
        treeGridModel: 'adjacency',
        height: 'auto',
        rowNum: 10000,
        treeGrid: true,
        ExpandColumn: 'ExpenseDate',
        caption: "TreeGrid Test",
        postData: postData,
        sortname:'SubcategoryID'
    });
    */

    CreateJQGridTree("#rowed2", '/report/JCategoryReport', colNames, colModel, 'ExpenseDate', 'Category Report', postData, 'SubcategoryID');
    //createJQGrid('/report/JCategoryReport', colNames, colModel, '', "", "Expense List", "#rowed2", '#prowed2', postData, { sidx: 'SubcategoryID', addgrid: false, editgrid: false, gridview: false, treeGrid: true });
</script>
