@model IEnumerable<Pocket.Models.Expense>

@{
    ViewBag.Title = "List";
}

<link href="~/Content/ui.jqgrid.css" rel="stylesheet" />
<link href="~/Content/themes/redmond/jquery.ui.datepicker.css" rel="stylesheet" />

<script src="~/Scripts/grid.locale-en.js"></script>
<script src="~/Scripts/jquery.jqGrid.src.js"></script>
<script src="~/Scripts/QIE/JqGrid.js"></script>
<script src="~/Scripts/QIE/DatePickerReady.js"></script>

<br />
<p>
    
    <label for="ddlgroup">Group By:</label> 
    <select name="ddlgroup" id="ddlgroup" onchange="LoadReport()">
        <option value="" label="None" selected="selected" />
        <option value="AccountID" label="Account"/>
        <option value="ExpenseDate" label="Date" />
        <option value="EventID" label="Event" />
        <option value="PayeeID" label="Payee" />
        <option value="VendorID" label="Vendor" />
    </select>
    <label for="ddlMonth">Report for the month:</label>
    <select name="ddlMonth" id="ddlMonth" onchange="ReloadGrid()">
        <option value="1" label="January"/>
        <option value="2" label="February" />
        <option value="3" label="March" />
        <option value="4" label="April" />
        <option value="5" label="May" />
        <option value="6" label="June" />
        <option value="7" label="July" />
        <option value="8" label="August" />
        <option value="9" label="September" />
        <option value="10" label="October" />
        <option value="11" label="November" />
        <option value="12" label="December" />
    </select>
    <select name="ddlYear" id="ddlYear" onchange="ReloadGrid()">
        @for (int i = 2001; i < 2020; i++)
        {
            <option value="@i" label="@i" />
        }
    </select>
    
</p>

<table id="rowed2"></table>
<div id="prowed2"></div>
<div>
    @Html.AntiForgeryToken()
</div>
<script type="text/javascript">
    var colNames = ['ExpenseID', 'Group', 'Expense Date', 'Category', 'Account', 'Amount', 'Payee', 'Vendor', 'Event'];
    var colModel = [
        { name: 'ExpenseID', index: 'ExpenseID', width: 55, key: true, hidden: true },
        { name: 'Group', index: 'Group', width: 200 },
        { name: 'ExpenseDate', index: 'ExpenseDate', width: 100, sorttype: "date", datefmt: 'mm/dd/yyyy'},
        { name: 'SubcategoryID', index: 'SubcategoryID', width: 100},
        { name: 'AccountID', index: 'AccountID', width: 100},
        { name: 'Amount', index: 'Amount', width: 100, sorttype: 'number', formatter: 'number', summaryType: 'sum' },
        { name: 'PayeeID', index: 'PayeeID', width: 100 },
        { name: 'VendorID', index: 'VendorID', width: 100 },
        { name: 'EventID', index: 'PayeeID', width: 100 }

    ];

   

    function LoadReport()
    {
        var groupingName = document.getElementById("ddlgroup").value;
        if (groupingName) {
            var grouporder = 'asc';
            if (groupingName == "ExpenseDate")
            {
                grouporder = 'desc';
                //$("#rowed2").remapColumns([0,1,2,3,4,5,6,7], true, false);
            }
                
            else
            {
                //$("#rowed2").remapColumns([0,3,1,2,4,5,6,7], true, false);
                //grouporder = 'asc';
            }
                
            $('#rowed2').jqGrid('groupingGroupBy', groupingName, {
                groupOrder: [grouporder],
                groupColumnShow: [true],
                groupCollapse: false,
                hideFirstGroupCol:false
            });
        } else {
            $('#rowed2').jqGrid('groupingRemove');
        }
        ReloadGrid();
        
        //createJQGrid('/report/jcategory', colNames, colModel, 'ExpenseID', "/expense/jedit", "Expense List", "#rowed2", '#prowed2', true, [groupby]);
    }
    function ReloadGrid() {
        jQuery("#rowed2").jqGrid().trigger("reloadGrid");
    }

    $("#ddlMonth").val('@DateTime.Today.Month');
    $("#ddlYear").val('@DateTime.Today.Year');

    var postData = {};
    postData["Month"] = function () { return $("#ddlMonth").val() };
    postData["Year"] = function () { return $("#ddlYear").val(); };

    createJQGrid('/report/JGroupReport', colNames, colModel, 'ExpenseID', "", "Expense List", "#rowed2", '#prowed2',
        postData, { sidx: 'ExpenseDate', sord: 'desc', grouping: true, groupOrder: 'desc', groupField: [], addgrid: false, editgrid: false });
</script>
